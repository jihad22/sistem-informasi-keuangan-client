<!--#include file="all-head.html"-->

<div class="row m-t-25">
	<div class="col-sm-3">
		<div class="card">
			<div class="card-header">
        <div class="card-title">
  				<h3 class="text-center title-2">Jumlah Siswa</h3>
        </div>
			</div>
			<div class="card-body">
				<form id="submitJumlahSiswa" method="POST" novalidate="novalidate">
					<label for="" class="control-label mb-1">T.A</label>
					<div class="form-group">
            <input id="periode1" type="text" class="form-control yearMask" data-inputmask-alias="datetime" data-inputmask-inputformat="yyyy" data-mask="" im-insert="false">
          </div>
          <div class="form-group">
            <input id="periode2" type="text" class="form-control yearMask" data-inputmask-alias="datetime" data-inputmask-inputformat="yyyy" data-mask="" im-insert="false">
          </div>
					<div class="form-group">
            <label for="jumlah" class="control-label mb-1">Jumlah</label>
            <input id="jmSiswa" name="" type="number" class="form-control" aria-required="true" aria-invalid="false" value="">
          </div>
          <div>
            <button id="payment-button" type="submit" class="btn btn-lg btn-info btn-block">
              <i class="fa fa-save fa-lg"></i>&nbsp; SIMPAN
            </button>
          </div>
				</form>
			</div>
		</div>
	</div>
	<div class="col-sm-9">
		<div class="table-responsive-lg">
      <table class="datatables table table-sm table-hover table-bordered table-striped">
        <thead>
          <tr>
            <th>No</th>
            <th>TA.</th>
            <th>Jumlah</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="dataJumlahSiswa"></tbody>
      </table>
    </div>
	</div>
</div>
<script>
  function ShowJmSiswa() {
  	API_REQUEST('all/jumlah-siswa', 'GET', token, '', '').done(function (response) {
  		let HTMLData = '';
      let no = 0;
      $.each(response, function (key, value) {
        HTMLData += `<tr class="text-right">
          <td>${ no+=1 }</td>
          <td>${ value.tahun_ajaran }</td>
          <td>${ value.jumlah_siswa } Org</td>
          <td>
            <button class="text-white btn btn-sm btn-warning" id="editJmSiswa" data-jmsiswa="${ value.id_jm_siswa }" data-toggle="modal" data-target="#modalJmSiswa"><i class="fa fa-edit"></i></button>
          </td>
        </tr>`
      });
      $('#dataJumlahSiswa').html(HTMLData);
  	});
  }
  //show all data jumlah siswa
  ShowJmSiswa();
  //submit form input jumlah data siswa
  $(document).on('submit', '#submitJumlahSiswa', function (e) {
  	e.preventDefault();
  	var data = JSON.stringify({
  		id_jm_siswa : "",
  		tahun_ajaran : $('#periode1').val() + "/" + $('#periode2').val(),
  		jumlah_siswa : parseInt($('#jmSiswa').val())
  	});
  	API_REQUEST('add/jumlah-siswa', 'POST', token, '', data).done(function () {
  		Swal.fire({
        icon: 'success',
        title: 'Ok',
        text: 'Created'
      }, ShowJmSiswa());
  	});
  });
  //edit jumlah siswa
  $(document).on('submit', '#submitEditJumlahSiswa', (e) => {
  	e.preventDefault()
  	var data = JSON.stringify({
  		id_jm_siswa : parseInt($('#idJmSiswa').val()),
      tahun_ajaran : $('#periode1Edit').val() +"/"+ $('#periode2Edit').val(),
      jumlah_siswa : parseInt($('#jmSiswaEdit').val())
  	});
  	API_REQUEST('update/jumlah-siswa', 'PUT', token, '', data).done(() => {
  		Swal.fire({
        icon: 'success',
        title: 'Ok',
        text: 'Updated'
      }, ShowJmSiswa());
  	});
  });
  //load modal form edit Bos
  $(document).ready(function () {
    $('#appendModalHere').load('modals/modal-edit-jmsiswa.html');
  });
</script>

<!--#include file="all-foot.html"-->