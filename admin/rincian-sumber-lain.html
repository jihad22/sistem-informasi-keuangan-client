<!--#include file="all-head.html"-->

<div class="row m-t-25">
  <div class="col-sm-3">
    <div class="card">
      <div class="card-body">
        <form id="submitRincianSumberLain" method="post" novalidate="novalidate">
          <div class="form-group">
            <!--<label for="sumber" class="control-label mb-1">Sumber</label>
            <input id="sumber" name="sumber" type="text" class="form-control" aria-required="true" aria-invalid="false" value="">-->
            <select class="form-control" id="jenisSumber"></select>
          </div>
          <div class="form-group">
            <label for="danaMasuk" class="control-label mb-1">Nominal</label>
            <input id="danaMasuk" name="dana_masuk" type="text" class="form-control" aria-required="true" aria-invalid="false" value="">
            <small class="text-muted rumus"></small>
          </div>
          <div class="form-group">
            <label for="keterangan" class="control-label mb-1">Keterangan</label>
            <textarea id="keterangan" rows="2" class="form-control"></textarea>
          </div>
          <div>
            <button id="payment-button" type="submit" class="btn btn-lg btn-info btn-block">
              <i class="fa fa-save fa-lg"></i>&nbsp;
              <span id="payment-button-amount">SIMPAN</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-sm-9">
    <div class="table-responsive m-b-40">
      <table class="table table-borderless table-data3">
        <thead>
          <tr>
            <th>No</th>
            <th>Sumber</th>
            <th>Dana Masuk</th>
            <th>Keterangan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="dataRincianSumberLain"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  //control form input rincian pendapatan dari sumber lain
  $(document).ready(() => {
    var rumus1 = 1;
    var rumus2 = 1;
    var rumus3 = 1;
    API_REQUEST('all/jenis-sumber', 'GET', token, '', '').done((response) => {
      let HTMLData = '';
      let no = 0;
      $.each(response, (key, value) => {
        HTMLData += `<option value="${ value.id_jenis_sumber }">${ value.sumber }</option>`;
        //rumus.push(value.rumus);
        $(document).on('change', '#jenisSumber', function () {
          var id = $(this).val();
          if (id == value.id_jenis_sumber) {
            rumus1 = value.rumus_var_1;
            rumus2 = value.rumus_var_2;
            rumus3 = value.rumus_var_3;
            $('.rumus').html("Rumus = Nominal * "+ rumus1 +" * "+ rumus2 +" * "+ rumus3);
          }
        });
      });
      $('#jenisSumber').html("<option>Pilih Sumber</option>" + HTMLData);
    });
    //digunakan untuk menangkap data dari form dan kirim ke server
    $("#submitRincianSumberLain").on('submit', function (e) {
      e.preventDefault();
      let data = JSON.stringify({
        id_rincian_sumber_lain: "",
        dana_masuk : removeCommaSeparator('#danaMasuk') * rumus1 * rumus2 * rumus3,
        keterangan : $('#keterangan').val(),
        sumber_lain_id : parseInt(ID),
        jenis_sumber_id : parseInt($('#jenisSumber option:selected').val())
      });
      API_REQUEST('add/rincian-sumber-lain', 'POST', token, '', data).done(function(){
        Swal.fire({
          icon: 'success',
          title: 'Ok',
          text: 'User Role Has Been Added'
        }, ShowAllRSL());
      });
    });
  });

  var ID = getQStringVal("idrsl");
  
  function ShowAllRSL() {
    API_REQUEST('all/rincian-sumber-lain/', 'GET', token, ID, '').done(function (response) {
      let no = 1;
      let HTMLData = '';
      $.each(response, function(index, el) {
        HTMLData += `<tr>
          <td>${ no++ }</td>
          <td class="text-lowercase">${ el.JenisSumbers.sumber }</td>
          <td>${ formatNum(el.dana_masuk) }</td>
          <td>${ el.keterangan }</td>
          <td>
            <div class="btn-group" role="group">
              <button class="text-white btn btn-sm btn-warning" id="updateRSL" data-id="${ el.id_rincian_sumber_lain }"><i class="fa fa-edit"></i> Ubah</button>
              <button class="text-white btn btn-sm btn-danger" id="deleteRSL" data-id="${ el.id_rincian_sumber_lain }"><i class="fa fa-remove"></i> Hapus</button>
            </div>
          </td>
        </tr>`;
      });
      $('#dataRincianSumberLain').html(HTMLData);
    });
  }
  //call function untuk menampilkan data
  ShowAllRSL()
  //delete rincian berdasarkan id
  $(document).on('click', '#deleteRSL', function(e){
    e.preventDefault();
    var id = $(this).data('id');
    Swal.fire({
      title: 'Apakah anda yakin ingin menghapus data ini?',
      text: "",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!',
      closeOnConfirm: false
    }).then((result) => {
      if (result.value == true) {
        API_REQUEST('delete/rincian-sumber-lain/', 'DELETE', token, id, '').done(function () {
          Swal.fire({
            icon: 'success',
            title: 'Ok',
            text: 'Data sudah dihapus'
          }, ShowAllRSL());
        });
      } else {
        result.dismiss;
      }
    });
  })
  //load modal form rincian sumber lain
  $(document).ready(function () {
    $('#appendModalHere').load('modals/modal-rincian-sumber-lain.html');
    $('#appendModalHere').append('modals/modal-edit-rincian-sumber-lain.html');
  });
</script>

<!--#include file="all-foot.html"-->